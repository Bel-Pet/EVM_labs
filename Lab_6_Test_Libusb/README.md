# TestLibUSB

1. БИБЛИОТЕКА LIBUSB
USB (Universal Serial Bus) – последовательный интерфейс передачи
данных для среднескоростных и низкоскоростных периферийных устройств.
Стандарт USB ввел единообразие в работу с широким спектром
периферийных устройств. До его появления использовалось множество
разных интерфейсов для подключения периферийных устройств
(последовательный порт RS-232C для модема, мыши, параллельный порт для
принтера и дисководов IOMEGA ZIP, PS/2 для мыши и клавиатуры,
специализированные интерфейсы для подключения сканеров и т. д.).
Программирование взаимодействия с USB-устройствами достаточно
трудоемко. Для упрощения работы с USB-устройствами из прикладных
программ была создана многоплатформенная библиотека libusb. Она
реализует универсальный низкоуровневый интерфейс, который позволяет
взаимодействовать со всеми возможными USB-устройствами. С помощью
библиотеки libusb можно получить список доступных USB-устройств, узнать
их параметры, обмениваться данными с устройствами в синхронном и
асинхронном режимах, реагировать на подключение и отключение
устройств.
Каждое конкретное устройство имеет свой специальный протокол
взаимодействия, и прикладная программа должна взаимодействовать с
устройством в соответствии с его протоколом, используя низкоуровневые
операции библиотеки libusb.
2. ПОЛУЧЕНИЕ ИНФОРМАЦИИ О ДОСТУПНЫХ
USB-УСТРОЙСТВАХ С ПОМОЩЬЮ БИБЛИОТЕКИ LIBUSB
Библиотека libusb предоставляет следующие функции, которые
позволяют получить информацию об имеющихся в системе USB-
устройствах:
 libusb_init – инициализация работы с libusb,
 libusb_exit – завершение работы с libusb,
 libusb_set_debug – установка уровня подробности отладочных
сообщений (рекомендуется использовать уровень 3),
 libusb_get_device_list – получение списка подключенных к машине
USB устройств,
 libusb_free_device_list – освобождение памяти, выделенной в функции
libusb_get_device_list для хранения данных со списком устройств,
 libusb_get_device_descriptor – получение дескриптора USB устройства,
 libusb_get_config_descriptor – получение дескриптора конфигурации
USB устройства,
 libusb_free_config_descriptor – освобождение памяти, выделенной в
функции libusb_get_config_descriptor,
 libusb_ref_device – увеличение счетчика числа пользователей
устройства на 1 (при первом вызове функции libusb_get_device_list
после подключения устройства его счетчик устанавливается в 1),
 libusb_unref_device – уменьшение счетчика числа пользователей
устройства на 1 (если счетчик уменьшается до нуля, дескриптор
устройства удаляется),
 libusb_open – открыть устройство (начать работать с устройством) и
получить дескриптор устройства, который далее можно использовать
для ввода/вывода данных,
 libusb_open_device_with_vid_pid – открыть устройство по его
идентификаторам производителя и изделия,
 libusb_close – закрыть устройство после его использования,
 libusb_get_string_descriptor_ascii – получить дескриптор устройства в
виде строки символов,
 lib_usb_error_name – преобразование кода ошибки библиотеки libusb в
строковое сообщение об ошибке.

ля компиляции программы в листинге 1 можно использовать
команду:
g++ -o executable –I/usr/include/libusb-1.0 main.cpp -lusb-1.0
Примечание. При запуске на собственном компьютере может понадобиться
разрешить доступ к USB-устройствам по чтению и записи. Например:
chmod 777 /dev/bus/usb/001/003
Альтернативный вариант заключается в запуске программы с правами
администратора:
sudo ./executable

3. ЗАДАНИЕ К ЛАБОРАТОРНОЙ РАБОТЕ
1. Реализовать программу, получающую список всех подключенных к
машине USB устройств с использованием libusb. Для каждого
найденного устройства напечатать его класс, идентификатор
производителя и идентификатор изделия. За основу для разработки
можно взять программу, приведенную в листинге 1.
2. Изучить состав и характеристики обнаруженных с помощью
реализованной программ USB устройств.
3. Дополнить программу, реализованную в п. 2 функцией печати
серийного номера USB устройства. Для написания функции
рекомендуется использовать функции libusb_open, libusb_close,
libusb_get_string_descriptor_ascii для печати поля iSerialNumber
дескриптора устройства.
